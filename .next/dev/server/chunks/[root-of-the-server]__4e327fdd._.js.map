{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/EDMAN/src/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb+srv://dilshadbvoc_db_user:enroller123@enroller.edixhqh.mongodb.net/?appName=Enroller';\r\n\r\nif (!MONGODB_URI) {\r\n    throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\ninterface MongooseCache {\r\n    conn: typeof mongoose | null;\r\n    promise: Promise<typeof mongoose> | null;\r\n}\r\n\r\n// Global interface generic extension for TypeScript\r\ndeclare global {\r\n    var mongoose: MongooseCache;\r\n}\r\n\r\nlet cached = global.mongoose;\r\n\r\nif (!cached) {\r\n    cached = global.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function connectDB() {\r\n    if (cached.conn) {\r\n        return cached.conn;\r\n    }\r\n\r\n    if (!cached.promise) {\r\n        const opts = {\r\n            bufferCommands: false,\r\n        };\r\n\r\n        cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n            return mongoose;\r\n        });\r\n    }\r\n\r\n    try {\r\n        cached.conn = await cached.promise;\r\n    } catch (e) {\r\n        cached.promise = null;\r\n        throw e;\r\n    }\r\n\r\n    return cached.conn;\r\n}\r\n\r\nexport default connectDB;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C;;AAcA,IAAI,SAAS,OAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACT,SAAS,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAC3D;AAEA,eAAe;IACX,IAAI,OAAO,IAAI,EAAE;QACb,OAAO,OAAO,IAAI;IACtB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACjB,MAAM,OAAO;YACT,gBAAgB;QACpB;QAEA,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACvD,OAAO;QACX;IACJ;IAEA,IAAI;QACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACtC,EAAE,OAAO,GAAG;QACR,OAAO,OAAO,GAAG;QACjB,MAAM;IACV;IAEA,OAAO,OAAO,IAAI;AACtB;uCAEe"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///D:/EDMAN/src/lib/models.ts"],"sourcesContent":["import mongoose, { Schema, Document, Model } from 'mongoose';\r\nimport { UserRole, LeadStatus, CourseType, CommissionStatus, PayoutStatus } from '@/types';\r\n\r\n// Interfaces for Mongoose Documents (extending generated types)\r\n// We use the existing interfaces from @/types but omit 'id' as Mongoose uses '_id'\r\n// We'll handle the conversion in the response helpers or usage.\r\n\r\n// --- User Model ---\r\nconst UserSchema = new Schema({\r\n    email: { type: String, required: true, unique: true },\r\n    password: { type: String, required: true },\r\n    name: { type: String, required: true },\r\n    role: {\r\n        type: String,\r\n        enum: ['ADMIN', 'AGENT', 'CENTER'],\r\n        default: 'AGENT'\r\n    },\r\n    phone: { type: String },\r\n}, { timestamps: true });\r\n\r\n// --- Center Model ---\r\nconst CenterSchema = new Schema({\r\n    name: { type: String, required: true },\r\n    address: { type: String },\r\n    contactPerson: { type: String },\r\n    phone: { type: String },\r\n    email: { type: String },\r\n    userId: { type: String, ref: 'User', required: true }, // Linking to User by string ID or ObjectId if we chose\r\n}, { timestamps: true });\r\n\r\n// --- Course Model ---\r\nconst CourseSchema = new Schema({\r\n    name: { type: String, required: true },\r\n    description: { type: String },\r\n    courseType: {\r\n        type: String,\r\n        enum: ['online_degree', 'credit_transfer', 'skill_course', 'vocational'],\r\n        required: true\r\n    },\r\n    fee: { type: Number, required: true },\r\n    commissionPercent: { type: Number, required: true },\r\n    centerId: { type: String, required: true }, // Using string IDs for simplicity with existing frontend, or could be ObjectId\r\n    isActive: { type: Boolean, default: true },\r\n}, { timestamps: true });\r\n\r\n// --- Lead Model ---\r\nconst LeadSchema = new Schema({\r\n    studentName: { type: String, required: true },\r\n    phone: { type: String, required: true },\r\n    email: { type: String },\r\n    courseId: { type: String, required: true }, // Can be ObjectId ref if we migrate fully\r\n    agentId: { type: String, required: true },\r\n    centerId: { type: String, required: true },\r\n    status: {\r\n        type: String,\r\n        enum: ['NEW', 'CONTACTED', 'INTERESTED', 'ENROLLED', 'CLOSED', 'LOST'],\r\n        default: 'NEW'\r\n    },\r\n    notes: { type: String },\r\n    followUpDate: { type: Date },\r\n    closedAt: { type: Date },\r\n}, { timestamps: true });\r\n\r\n// --- Commission Model ---\r\nconst CommissionSchema = new Schema({\r\n    leadId: { type: String, required: true },\r\n    agentId: { type: String, required: true },\r\n    amount: { type: Number, required: true },\r\n    status: {\r\n        type: String,\r\n        enum: ['PENDING', 'APPROVED', 'PAID'],\r\n        default: 'PENDING'\r\n    },\r\n    paidAt: { type: Date },\r\n}, { timestamps: true });\r\n\r\n// --- Payout Model ---\r\nconst PayoutSchema = new Schema({\r\n    agentId: { type: String, required: true },\r\n    totalAmount: { type: Number, required: true },\r\n    commissionIds: [{ type: String }],\r\n    status: {\r\n        type: String,\r\n        enum: ['REQUESTED', 'APPROVED', 'PAID', 'REJECTED'],\r\n        default: 'REQUESTED'\r\n    },\r\n    approvedAt: { type: Date },\r\n    paidAt: { type: Date },\r\n    notes: { type: String },\r\n}, { timestamps: true });\r\n\r\n// Helper to prevent overwriting models during hot reloads\r\nconst getModel = <T extends Document>(name: string, schema: Schema<T>): Model<T> => {\r\n    return mongoose.models[name] || mongoose.model<T>(name, schema);\r\n};\r\n\r\nexport const User = getModel('User', UserSchema);\r\nexport const Center = getModel('Center', CenterSchema);\r\nexport const Course = getModel('Course', CourseSchema);\r\nexport const Lead = getModel('Lead', LeadSchema);\r\nexport const Commission = getModel('Commission', CommissionSchema);\r\nexport const Payout = getModel('Payout', PayoutSchema);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 335, "column": 0}, "map": {"version":3,"sources":["file:///D:/EDMAN/src/lib/db.ts"],"sourcesContent":["// MongoDB adapter and helper functions\r\nimport connectDB from './mongodb';\r\nimport { User, Center, Course, Lead, Commission, Payout } from './models';\r\nimport bcrypt from 'bcryptjs';\r\n\r\n// Function to ensure database is initialized with seed data\r\nexport async function ensureInitialized() {\r\n    await connectDB();\r\n\r\n    // Check if admin exists\r\n    const adminCount = await User.countDocuments({ role: 'ADMIN' });\r\n\r\n    if (adminCount === 0) {\r\n        console.log('Seeding database...');\r\n        const hashedPassword = await bcrypt.hash('admin123', 10);\r\n\r\n        // Create admin user\r\n        await User.create({\r\n            email: 'admin@edman.com',\r\n            password: hashedPassword,\r\n            name: 'System Admin',\r\n            role: 'ADMIN',\r\n        });\r\n\r\n        // Create sample center user\r\n        const centerUser = await User.create({\r\n            email: 'center@edman.com',\r\n            password: hashedPassword,\r\n            name: 'Demo Center',\r\n            role: 'CENTER',\r\n            phone: '+91 9876543210',\r\n        });\r\n\r\n        // Create sample agent user\r\n        await User.create({\r\n            email: 'agent@edman.com',\r\n            password: hashedPassword,\r\n            name: 'Demo Agent',\r\n            role: 'AGENT',\r\n            phone: '+91 9876543211',\r\n        });\r\n\r\n        // Create center\r\n        const center = await Center.create({\r\n            name: 'Main Training Center',\r\n            address: '123 Education Street, Learning City',\r\n            contactPerson: 'John Manager',\r\n            phone: '+91 9876543210',\r\n            email: 'center@edman.com',\r\n            userId: centerUser._id.toString(), // Store as string\r\n        });\r\n\r\n        // Create sample courses\r\n        await Course.create([\r\n            {\r\n                name: 'Web Development Bootcamp',\r\n                description: 'Complete web development course covering HTML, CSS, JavaScript, React, and Node.js',\r\n                courseType: 'skill_course',\r\n                fee: 25000,\r\n                commissionPercent: 10,\r\n                centerId: center._id.toString(),\r\n                isActive: true,\r\n            },\r\n            {\r\n                name: 'Data Science Fundamentals',\r\n                description: 'Learn Python, Machine Learning, and Data Analysis',\r\n                courseType: 'online_degree',\r\n                fee: 35000,\r\n                commissionPercent: 10,\r\n                centerId: center._id.toString(),\r\n                isActive: true,\r\n            },\r\n            {\r\n                name: 'Digital Marketing Mastery',\r\n                description: 'SEO, Social Media Marketing, Google Ads, and Content Strategy',\r\n                courseType: 'vocational',\r\n                fee: 15000,\r\n                commissionPercent: 15,\r\n                centerId: center._id.toString(),\r\n                isActive: true,\r\n            }\r\n        ]);\r\n\r\n        console.log('Database seeded successfully');\r\n    }\r\n}\r\n\r\n// Helpers - these are now Async wrappers or direct exports of models if needed\r\n// But preserving the function signatures as async helps migration\r\n\r\nexport async function findUserByEmail(email: string) {\r\n    await connectDB();\r\n    const user = await User.findOne({ email });\r\n    return user ? mapDoc(user) : null;\r\n}\r\n\r\nexport async function findUserById(id: string) {\r\n    await connectDB();\r\n    const user = await User.findById(id);\r\n    return user ? mapDoc(user) : null;\r\n}\r\n\r\n// Helper to convert Mongoose document to plain object and map _id to id\r\nfunction mapDoc(doc: any) {\r\n    if (!doc) return null;\r\n    const obj = doc.toObject ? doc.toObject() : doc;\r\n    obj.id = obj._id.toString();\r\n    delete obj._id;\r\n    delete obj.__v;\r\n    return obj;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;AAAA,uCAAuC;AACvC;AACA;AACA;;;;AAGO,eAAe;IAClB,MAAM,IAAA,kIAAS;IAEf,wBAAwB;IACxB,MAAM,aAAa,MAAM,8HAAI,CAAC,cAAc,CAAC;QAAE,MAAM;IAAQ;IAE7D,IAAI,eAAe,GAAG;QAClB,QAAQ,GAAG,CAAC;QACZ,MAAM,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,YAAY;QAErD,oBAAoB;QACpB,MAAM,8HAAI,CAAC,MAAM,CAAC;YACd,OAAO;YACP,UAAU;YACV,MAAM;YACN,MAAM;QACV;QAEA,4BAA4B;QAC5B,MAAM,aAAa,MAAM,8HAAI,CAAC,MAAM,CAAC;YACjC,OAAO;YACP,UAAU;YACV,MAAM;YACN,MAAM;YACN,OAAO;QACX;QAEA,2BAA2B;QAC3B,MAAM,8HAAI,CAAC,MAAM,CAAC;YACd,OAAO;YACP,UAAU;YACV,MAAM;YACN,MAAM;YACN,OAAO;QACX;QAEA,gBAAgB;QAChB,MAAM,SAAS,MAAM,gIAAM,CAAC,MAAM,CAAC;YAC/B,MAAM;YACN,SAAS;YACT,eAAe;YACf,OAAO;YACP,OAAO;YACP,QAAQ,WAAW,GAAG,CAAC,QAAQ;QACnC;QAEA,wBAAwB;QACxB,MAAM,gIAAM,CAAC,MAAM,CAAC;YAChB;gBACI,MAAM;gBACN,aAAa;gBACb,YAAY;gBACZ,KAAK;gBACL,mBAAmB;gBACnB,UAAU,OAAO,GAAG,CAAC,QAAQ;gBAC7B,UAAU;YACd;YACA;gBACI,MAAM;gBACN,aAAa;gBACb,YAAY;gBACZ,KAAK;gBACL,mBAAmB;gBACnB,UAAU,OAAO,GAAG,CAAC,QAAQ;gBAC7B,UAAU;YACd;YACA;gBACI,MAAM;gBACN,aAAa;gBACb,YAAY;gBACZ,KAAK;gBACL,mBAAmB;gBACnB,UAAU,OAAO,GAAG,CAAC,QAAQ;gBAC7B,UAAU;YACd;SACH;QAED,QAAQ,GAAG,CAAC;IAChB;AACJ;AAKO,eAAe,gBAAgB,KAAa;IAC/C,MAAM,IAAA,kIAAS;IACf,MAAM,OAAO,MAAM,8HAAI,CAAC,OAAO,CAAC;QAAE;IAAM;IACxC,OAAO,OAAO,OAAO,QAAQ;AACjC;AAEO,eAAe,aAAa,EAAU;IACzC,MAAM,IAAA,kIAAS;IACf,MAAM,OAAO,MAAM,8HAAI,CAAC,QAAQ,CAAC;IACjC,OAAO,OAAO,OAAO,QAAQ;AACjC;AAEA,wEAAwE;AACxE,SAAS,OAAO,GAAQ;IACpB,IAAI,CAAC,KAAK,OAAO;IACjB,MAAM,MAAM,IAAI,QAAQ,GAAG,IAAI,QAAQ,KAAK;IAC5C,IAAI,EAAE,GAAG,IAAI,GAAG,CAAC,QAAQ;IACzB,OAAO,IAAI,GAAG;IACd,OAAO,IAAI,GAAG;IACd,OAAO;AACX"}},
    {"offset": {"line": 467, "column": 0}, "map": {"version":3,"sources":["file:///D:/EDMAN/src/lib/auth.ts"],"sourcesContent":["// Authentication utilities using Jose for JWT\r\n\r\nimport { SignJWT, jwtVerify } from 'jose';\r\nimport { cookies } from 'next/headers';\r\nimport { User } from '@/types';\r\n\r\nconst JWT_SECRET = new TextEncoder().encode(\r\n    process.env.JWT_SECRET || 'your-super-secret-key-change-in-production'\r\n);\r\n\r\nconst COOKIE_NAME = 'auth-token';\r\n\r\nexport async function createToken(user: User): Promise<string> {\r\n    return await new SignJWT({\r\n        id: user.id,\r\n        email: user.email,\r\n        name: user.name,\r\n        role: user.role,\r\n    })\r\n        .setProtectedHeader({ alg: 'HS256' })\r\n        .setIssuedAt()\r\n        .setExpirationTime('7d')\r\n        .sign(JWT_SECRET);\r\n}\r\n\r\nexport async function verifyToken(token: string): Promise<{\r\n    id: string;\r\n    email: string;\r\n    name: string;\r\n    role: string;\r\n} | null> {\r\n    try {\r\n        const { payload } = await jwtVerify(token, JWT_SECRET);\r\n        return payload as {\r\n            id: string;\r\n            email: string;\r\n            name: string;\r\n            role: string;\r\n        };\r\n    } catch {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function setAuthCookie(token: string): Promise<void> {\r\n    const cookieStore = await cookies();\r\n    cookieStore.set(COOKIE_NAME, token, {\r\n        httpOnly: true,\r\n        secure: process.env.NODE_ENV === 'production',\r\n        sameSite: 'lax',\r\n        maxAge: 60 * 60 * 24 * 7, // 7 days\r\n        path: '/',\r\n    });\r\n}\r\n\r\nexport async function getAuthCookie(): Promise<string | undefined> {\r\n    const cookieStore = await cookies();\r\n    return cookieStore.get(COOKIE_NAME)?.value;\r\n}\r\n\r\nexport async function removeAuthCookie(): Promise<void> {\r\n    const cookieStore = await cookies();\r\n    cookieStore.delete(COOKIE_NAME);\r\n}\r\n\r\nexport async function getCurrentUser(): Promise<{\r\n    id: string;\r\n    email: string;\r\n    name: string;\r\n    role: string;\r\n} | null> {\r\n    const token = await getAuthCookie();\r\n    if (!token) return null;\r\n    return await verifyToken(token);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,8CAA8C;AAE9C;AAAA;AACA;;;AAGA,MAAM,aAAa,IAAI,cAAc,MAAM,CACvC,QAAQ,GAAG,CAAC,UAAU,IAAI;AAG9B,MAAM,cAAc;AAEb,eAAe,YAAY,IAAU;IACxC,OAAO,MAAM,IAAI,uKAAO,CAAC;QACrB,IAAI,KAAK,EAAE;QACX,OAAO,KAAK,KAAK;QACjB,MAAM,KAAK,IAAI;QACf,MAAM,KAAK,IAAI;IACnB,GACK,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,MAClB,IAAI,CAAC;AACd;AAEO,eAAe,YAAY,KAAa;IAM3C,IAAI;QACA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,2KAAS,EAAC,OAAO;QAC3C,OAAO;IAMX,EAAE,OAAM;QACJ,OAAO;IACX;AACJ;AAEO,eAAe,cAAc,KAAa;IAC7C,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,GAAG,CAAC,aAAa,OAAO;QAChC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;QACvB,MAAM;IACV;AACJ;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,OAAO,YAAY,GAAG,CAAC,cAAc;AACzC;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,YAAY,MAAM,CAAC;AACvB;AAEO,eAAe;IAMlB,MAAM,QAAQ,MAAM;IACpB,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,MAAM,YAAY;AAC7B"}},
    {"offset": {"line": 534, "column": 0}, "map": {"version":3,"sources":["file:///D:/EDMAN/src/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport bcrypt from 'bcryptjs';\r\nimport { findUserByEmail, ensureInitialized } from '@/lib/db';\r\nimport { createToken, setAuthCookie } from '@/lib/auth';\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        // Ensure database is initialized\r\n        await ensureInitialized();\r\n\r\n        const { email, password } = await request.json();\r\n\r\n        if (!email || !password) {\r\n            return NextResponse.json(\r\n                { error: 'Email and password are required' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const user = await findUserByEmail(email);\r\n\r\n        if (!user) {\r\n            return NextResponse.json(\r\n                { error: 'Invalid email or password' },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        const isValid = await bcrypt.compare(password, user.password || '');\r\n\r\n        if (!isValid) {\r\n            return NextResponse.json(\r\n                { error: 'Invalid email or password' },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        const token = await createToken(user);\r\n        await setAuthCookie(token);\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            user: {\r\n                id: user.id,\r\n                email: user.email,\r\n                name: user.name,\r\n                role: user.role,\r\n            },\r\n        });\r\n    } catch (error) {\r\n        console.error('Login error:', error);\r\n        return NextResponse.json(\r\n            { error: 'Login failed' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,iCAAiC;QACjC,MAAM,IAAA,uIAAiB;QAEvB,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE9C,IAAI,CAAC,SAAS,CAAC,UAAU;YACrB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,OAAO,MAAM,IAAA,qIAAe,EAAC;QAEnC,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAA4B,GACrC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ,IAAI;QAEhE,IAAI,CAAC,SAAS;YACV,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAA4B,GACrC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,QAAQ,MAAM,IAAA,mIAAW,EAAC;QAChC,MAAM,IAAA,qIAAa,EAAC;QAEpB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,MAAM;gBACF,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;YACnB;QACJ;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAe,GACxB;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}