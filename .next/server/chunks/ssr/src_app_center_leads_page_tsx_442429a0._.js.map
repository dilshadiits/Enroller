{"version":3,"sources":["../../../../src/app/center/leads/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\n\r\ninterface Lead {\r\n    id: string;\r\n    studentName: string;\r\n    phone: string;\r\n    email?: string;\r\n    status: string;\r\n    notes?: string;\r\n    createdAt: string;\r\n    updatedAt: string;\r\n    course?: { name: string; fee: number };\r\n    agent?: { name: string; email: string };\r\n}\r\n\r\nconst STATUSES = ['NEW', 'CONTACTED', 'INTERESTED', 'ENROLLED', 'CLOSED', 'LOST'];\r\n\r\nexport default function CenterLeadsPage() {\r\n    const [leads, setLeads] = useState<Lead[]>([]);\r\n    const [selectedLead, setSelectedLead] = useState<Lead | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [updating, setUpdating] = useState(false);\r\n    const [filter, setFilter] = useState('ALL');\r\n    const [updateForm, setUpdateForm] = useState({ status: '', notes: '' });\r\n\r\n    useEffect(() => {\r\n        fetchLeads();\r\n    }, []);\r\n\r\n    const fetchLeads = async () => {\r\n        try {\r\n            const res = await fetch('/api/leads');\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setLeads(data.leads);\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to fetch leads:', err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const openLeadModal = (lead: Lead) => {\r\n        setSelectedLead(lead);\r\n        setUpdateForm({ status: lead.status, notes: lead.notes || '' });\r\n    };\r\n\r\n    const updateLead = async () => {\r\n        if (!selectedLead) return;\r\n\r\n        setUpdating(true);\r\n        try {\r\n            const res = await fetch(`/api/leads/${selectedLead.id}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(updateForm),\r\n            });\r\n\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setLeads(leads.map(l => l.id === selectedLead.id ? { ...l, ...data.lead } : l));\r\n                setSelectedLead(null);\r\n                alert('Lead updated successfully!');\r\n            } else {\r\n                const data = await res.json();\r\n                alert(data.error || 'Failed to update lead');\r\n            }\r\n        } catch (err) {\r\n            alert('Failed to update lead');\r\n        } finally {\r\n            setUpdating(false);\r\n        }\r\n    };\r\n\r\n    const filteredLeads = filter === 'ALL' ? leads : leads.filter(l => l.status === filter);\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex-center\" style={{ padding: '4rem' }}>\r\n                <div className=\"spinner\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"fade-in\">\r\n            <div className=\"page-header\">\r\n                <h1 className=\"page-title\">Incoming Leads</h1>\r\n                <p className=\"page-subtitle\">Process and update lead statuses</p>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"flex gap-sm\" style={{ marginBottom: 'var(--spacing-xl)', flexWrap: 'wrap' }}>\r\n                <button\r\n                    className={`btn btn-sm ${filter === 'ALL' ? 'btn-primary' : 'btn-secondary'}`}\r\n                    onClick={() => setFilter('ALL')}\r\n                >\r\n                    All ({leads.length})\r\n                </button>\r\n                {STATUSES.map(status => (\r\n                    <button\r\n                        key={status}\r\n                        className={`btn btn-sm ${filter === status ? 'btn-primary' : 'btn-secondary'}`}\r\n                        onClick={() => setFilter(status)}\r\n                    >\r\n                        {status} ({leads.filter(l => l.status === status).length})\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Leads Table */}\r\n            <div className=\"card\">\r\n                {filteredLeads.length === 0 ? (\r\n                    <div className=\"empty-state\">\r\n                        <div className=\"empty-state-icon\">ðŸ“‹</div>\r\n                        <p>No leads found {filter !== 'ALL' ? `with status \"${filter}\"` : ''}</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"table-container\">\r\n                        <table>\r\n                            <thead>\r\n                                <tr>\r\n                                    <th>Student</th>\r\n                                    <th>Contact</th>\r\n                                    <th>Course</th>\r\n                                    <th>Agent</th>\r\n                                    <th>Status</th>\r\n                                    <th>Date</th>\r\n                                    <th>Action</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {filteredLeads.map(lead => (\r\n                                    <tr key={lead.id}>\r\n                                        <td style={{ fontWeight: 500 }}>{lead.studentName}</td>\r\n                                        <td>\r\n                                            <div>{lead.phone}</div>\r\n                                            {lead.email && (\r\n                                                <div style={{ fontSize: '0.75rem', color: 'var(--text-muted)' }}>\r\n                                                    {lead.email}\r\n                                                </div>\r\n                                            )}\r\n                                        </td>\r\n                                        <td>\r\n                                            <div>{lead.course?.name || 'N/A'}</div>\r\n                                            <div style={{ fontSize: '0.75rem', color: 'var(--secondary)' }}>\r\n                                                â‚¹{lead.course?.fee?.toLocaleString() || 'N/A'}\r\n                                            </div>\r\n                                        </td>\r\n                                        <td>{lead.agent?.name || 'N/A'}</td>\r\n                                        <td>\r\n                                            <span className={`badge badge-${lead.status.toLowerCase()}`}>\r\n                                                {lead.status}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td style={{ color: 'var(--text-muted)' }}>\r\n                                            {new Date(lead.createdAt).toLocaleDateString()}\r\n                                        </td>\r\n                                        <td>\r\n                                            <button\r\n                                                onClick={() => openLeadModal(lead)}\r\n                                                className=\"btn btn-primary btn-sm\"\r\n                                            >\r\n                                                Update\r\n                                            </button>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Update Lead Modal */}\r\n            {selectedLead && (\r\n                <div className=\"modal-overlay\" onClick={() => setSelectedLead(null)}>\r\n                    <div className=\"modal\" onClick={e => e.stopPropagation()}>\r\n                        <div className=\"modal-header\">\r\n                            <h2>Update Lead</h2>\r\n                            <button className=\"modal-close\" onClick={() => setSelectedLead(null)}>Ã—</button>\r\n                        </div>\r\n\r\n                        <div style={{ marginBottom: 'var(--spacing-lg)' }}>\r\n                            <div style={{\r\n                                padding: 'var(--spacing-md)',\r\n                                background: 'var(--bg-tertiary)',\r\n                                borderRadius: 'var(--radius-md)',\r\n                                marginBottom: 'var(--spacing-md)'\r\n                            }}>\r\n                                <div style={{ fontWeight: 600 }}>{selectedLead.studentName}</div>\r\n                                <div style={{ fontSize: '0.875rem', color: 'var(--text-muted)' }}>\r\n                                    {selectedLead.phone} â€¢ {selectedLead.course?.name}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"status\">Status</label>\r\n                                <select\r\n                                    id=\"status\"\r\n                                    value={updateForm.status}\r\n                                    onChange={(e) => setUpdateForm({ ...updateForm, status: e.target.value })}\r\n                                >\r\n                                    {STATUSES.map(status => (\r\n                                        <option key={status} value={status}>{status}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n\r\n                            <div className=\"form-group\">\r\n                                <label htmlFor=\"notes\">Notes</label>\r\n                                <textarea\r\n                                    id=\"notes\"\r\n                                    placeholder=\"Add follow-up notes...\"\r\n                                    value={updateForm.notes}\r\n                                    onChange={(e) => setUpdateForm({ ...updateForm, notes: e.target.value })}\r\n                                    rows={3}\r\n                                />\r\n                            </div>\r\n\r\n                            {updateForm.status === 'CLOSED' && (\r\n                                <div className=\"alert alert-success\">\r\n                                    âœ¨ Closing this lead will generate a commission for the agent!\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"flex gap-md\">\r\n                            <button\r\n                                onClick={() => setSelectedLead(null)}\r\n                                className=\"btn btn-secondary\"\r\n                                style={{ flex: 1 }}\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={updateLead}\r\n                                className=\"btn btn-primary\"\r\n                                style={{ flex: 1 }}\r\n                                disabled={updating}\r\n                            >\r\n                                {updating ? 'Updating...' : 'Save Changes'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}